Web Service HPWS.XMLServer
Codificação:
Para elucidação de como fazer o processo de codificação (encoder), segue abaixo um exemplo implementado na linguagem JAVA.

É importante salientar que o processo aqui descrito é apenas uma documentação de como implementar a codificação para a Base64, portanto serão abordados somente pontos importantes do código.


Codificação:

Na implementação da codificação vamos usar a imagem de um gráfico bidimensional.

Para gerar o gráfico, usamos a biblioteca JFreeChart.

Para que possamos fazer o gráfico precisamos passar os valores e alguns parâmetros para o JFreeChart que automaticamente produz o gráfico, neste caso um gráfico vetorial X,Y.


Após obtermos o gráfico, é hora de transforma-lo em imagem e posteriormente em binário.

Neste processo usamos o método createBufferedImage() do nosso objeto grafico que é do tipo JFreeChart passando como parâmetro os valores 640, 480 que correspondem a largura e a altura da imagem respectivamente.

Após obtermos a imagem do gráfico (Gráfico de eletroforese), a "escrevemos" em um objeto do tipo ByteArrayOutputStream, esse objeto possui o método toByteArray() que usamos para passar a imagem no formato de byte array como parâmetro para o método encode da classe Base64, esse método é responsável por transformar o array de bytes em binários, que por sua vez são armazenados na String que povoará a tag Grafico do XML de retorno.

final BufferedImage image = grafico.createBufferedImage(640, 480);
final ByteArrayOutputStream baos = new ByteArrayOutputStream();
ImageIO.write(image, "png", baos);
final String encodedImage = Base64.encode(baos.toByteArray());
Obs: Neste exemplo fizemos a codificação do Gráfico de eletroforese.

Esse processo gera os binários que compõem a tag Gráfico do XML de retorno, é importante ressaltar que o valor obtido através deste processo é universal e pode ser implementado em outras linguagens de programação, tanto para o processo de codificação (encoder) quanto para o processo de decodificação (decoder).



Web Service HPWS.XMLServer
Classe GraficoEletroforese:
Esta classe é responsável por implementar os métodos de codificação (encoder) e decodificação (decoder) do gráfico de eletroforese.


package br.com.hpardini.eletroforese;
 
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
 
import javax.imageio.ImageIO;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
 
import org.jfree.chart.JFreeChart;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;
 
 
import com.sun.org.apache.xerces.internal.impl.dv.util.Base64;
 
/**
 * @author Rogério Alcântara Valente.
 * @param 
 * @since 20/06/2011
 */
public class GraficoEletroforese {
	/**
	 * Converte os binários do XML de retorno para um arquivo de imagem.
	 * @param loCompleteFilePath - local onde se encontra o arquivo XML.
	 * @param fullpath - local onde será salvo o arquivo de imagem.
	 */
	public void coverterParaImagem(String loCompleteFilePath, String fullpath) {
		final DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
		String loStrImageBinary = "";
		try {
			// Using factory get an instance of document builder
			final DocumentBuilder db = dbf.newDocumentBuilder();
			// parse using builder to get DOM representation of the XML file
			final Document dom = db.parse(loCompleteFilePath);
			final Element docEle = dom.getDocumentElement();
			loStrImageBinary = getChildTagValue(docEle, "Grafico");
		} catch (final ParserConfigurationException pce) {
			pce.printStackTrace();
		} catch (final SAXException se) {
			se.printStackTrace();
		} catch (final IOException ioe) {
			ioe.printStackTrace();
		}
		// convert byte array back to BufferedImage
		final InputStream in = new ByteArrayInputStream(loStrImageBinary.getBytes());
		BufferedImage bImageFromConvert;
		
		try {
			
			bImageFromConvert = ImageIO.read(in);
			ImageIO.write(bImageFromConvert, "png", new File(fullpath + "nova-imagem.png"));
			
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	/**
	 * Converte o gráfico de eletroforese em imagem e posteriormente em binário.
	 * @param grafico - Objeto do tipo JFreeChart
	 * @return String
	 */
	public String converterParaBase64(JFreeChart grafico) {
		String encodedImage = "";
		try {
			final BufferedImage image = grafico.createBufferedImage(640, 480);
			final ByteArrayOutputStream baos = new ByteArrayOutputStream();
			ImageIO.write(image, "png", baos);
			encodedImage = Base64.encode(baos.toByteArray());
			//String contendo os binários que irão povoar a tag Grafico do XML de retorno.
			return encodedImage;
		} catch (final Exception e) {
			System.err.println(e.toString());
		}
		return encodedImage;
	}
	private String getChildTagValue(final Element pTagRegResult, final String pTagName) {
		final NodeList children = pTagRegResult.getElementsByTagName(pTagName);
		if (children == null) {
			return null;
		}
		final Element child = (Element) children.item(0);
		if (child == null) {
			return null;
		}
		String retorno = "";
		try {
			retorno = child.getFirstChild().getNodeValue();
		} catch (final Exception e) {
			retorno = null;
		}
		return retorno;
	}
}
